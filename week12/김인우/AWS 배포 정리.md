# 학습 목표
이전 세션 -> http://<EC2 IP>:8080을 통해서만 접속 가능  
이번 세션 진행 후-> https://<도메인 주소>를 통해서도 접속 가능  
  
# 요청 흐름
사용자의 url 요청(https://<도메인 주소>) -> DNS 질의 -> ALB   주소 획득 -> http 요청 암호화 -> ALB를 통한 서버 접속  
  
# 도메인 등록
예) 가비아 사이트에서 도메인 구입(inwoo.store) + Route 53의 NS 주소를 네임서버로 설정  
-> 가비아 측 :  (.store) TLD 네임서버에 (inwoo.store는 Route 53의 네임서버가 관리해요) 라는 정보 추가  
  
# DNS 질의 흐름
DNS란? 도메인 주소 -> IP 주소 로 바꾸는 시스템  
브라우저는 DNS Resolver를 통해 도메인의 IP를 찾음  
DNS Resolver는(Root - TLD - 권한 있는 네임서버) 순으로 질의함  
  
##### <DNS Resolver -> Root Server>
도메인 확장자(.com, .net)에 대한 네임서버 정보를 갖고 있는 TLD 네임서버의 주소를 응답  
TLD Server : (.com(예시))로 끝나는 도메인의 네임서버 정보를 갖고 있음  
  
##### <DNS Resolver -> TLD Server>
도메인 이름에 해당하는 '권한 있는 네임서버'의 주소를 응답  
- 세션 예시) Route 53의 호스팅 영역에 대한 주소를 반환  
  
##### <DNS Resolver -> 권한 있는 Server(Route 53)>
최종적인 서버의 IP 주소를 응답  
- 세션 예시) Route 53이 레코드(로드밸런서 주소) 반환  

# Route 53
### 레코드
NS -> Route 53의 네임서버 주소를 정의하는 레코드  
A, CNAME -> 실제 연결할 서버 주소를 제공하는 레코드  
Alias -> 별칭 설정을 통해 IP 주소 없이 ALB에 연결 가능  
  
### 레코드 선택 및 응답 원리
레코드 이름이 일치하는 레코드들 선별   
-> 라우팅 정책, 조건에 따라 우선순위가 높은 레코드 응답  
  
# ALB(로드밸런서)
서버의 부하를 분산하기 위해 사용하는 장비  
  
### 종류
NLB : TCP/UDP 정보로 분배 (예: IP 주소,포트,프로토콜을 기준으로 분배)  
ALB : Http 정보로 분배 (예: URL, 요청 헤더를 기준으로 분배)  
  
### ALB의 위치
VPC의 퍼블릭 서브넷  
예) 로드 밸런서 - 퍼블릭 서브넷 / 백엔드 서버 - 프라이빗 서브넷  
-> 사용자가 백엔드 서버에 접근하지 못하게 함으로써 보안을 강화  
  
### 가용 영역
AWS 지역 안 물리적으로 분리된 데이터 센터 단위  
예) ap-northeast-2(지역) -> ap-northeast-2a, 2b, 2c(가용 영역 존재)  
  
서로 독립된 물리 시설 보유 -> 한 가용 영역에 장애가 나도 정상 운영 가능  
  
VPC에서의 서브넷 : 가용 영역 + 퍼블릭/프라이빗 여부로 구분됨
EC2 인스턴스 만들 때도 VPC/서브넷이 만들어지면서 가용영역이 설정됨   
-> EC2와 ALB의 가용 영역이 일치해야 사용 가능  
-> ALB 만들 때, EC2와 같은 가용영역을 지정해야 함  
  
### 대상 그룹
ALB가 Http 요청을 보낼 대상 서버들의 집합  
대상 그룹에 있는 서버들에게 요청을 골고루 분배함  
  
# https 요청
### https란?
http 요청 + 인증서(SSL/TLS)  
로그인, 결제 http 요청 -> 중간에 해킹당할 가능성 -> http 요청 암호화 필요성  
  
### 인증서를 통한 https 요청
인증서 역할  
암호화 : Http 요청 중 사용자 정보 등을 암호화해서 서버에 전송  
서버 신원 확인 : 사이트가 진짜인지 확인  
-> ALB가 인증서 가짐 -> 브라우저가 ALB로 요청 보내도 된다고 판단    
데이터 위조/변조 방지 : 전송 도중 데이터가 바뀌지 않았는지 확인  

### TLS HandShake  
HTTPS 요청을 보내기 전, 서버 측에 인증서를 확인하는 절차  
1단계: 클라이언트 -> 서버   
TLS 프로토콜 버전, 사용가능 암호 그룹, 무작위 문자열 1 전달   
2단계: 서버 -> 클라이언트  
인증서 정보, 암호 그룹, 공개키, 무작위 문자열 2, '완료' 메시지 전달  
3단계: 클라이언트 -> 서버  
인증서 유효성 검사 후 무작위 문자열 1,2를 합쳐 세션 키 생성  
세션 키와 '완료' 메시지 전달  
  
TLS HandShake 절차가 끝난 후   
클라이언트/서버만 아는 방식(세션 키 이용)으로 암호화된 HTTP 요청/응답을 함  